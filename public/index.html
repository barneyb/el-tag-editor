<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EL Tag Editor</title>
    <!--suppress CssUnusedSymbol -->
    <style>
        /* "application" styles */
        #tags { padding: 10px;
            border: 1px solid #900 }
        textarea { width: 400px;
            height: 80px }
        /* candidate component styles */
        .TagEditor {
            padding: 3px;
            border: 1px solid #ccc }
        .NewTag input {
            border-width: 0;
            outline-width: 0 }
        .Pill {
            display: inline-block;
            padding: 1px 3px;
            margin: 1px 5px 1px 0;
            border: 1px solid #09f;
            background-color: #f0f7ff }
        .Pill input {
            border-width: 0 }
        .Label {
            display: inline-block;
            margin: 1px 3px }
        .Label.delete {
            cursor: pointer }
        .EditInPlace.number input {
            width: 4em }
        .Input {
            display: inline-block }
        .Input .Completions {
            position: absolute;
            background-color: #ffe;
            border: 1px solid #cc6 }
        .Input .Completions ul {
            list-style: none;
            padding: 0;
            margin: 0 }
        .Input .Completions ul li {
            padding: 3px 5px;
            margin: 0 }
        .Input .Completions ul li.active {
            background-color: #cc6 }
        .NextTags ul {
            list-style: none;
            padding: 0;
            margin: 0 }
        .NextTag {
            display: inline-block;
            padding: 1px 3px;
            margin: 1px 3px 1px 0;
            border: 1px solid #def;
            background-color: #f9fcff;
            cursor: pointer }
    </style>
</head>
<body>
<div id="tags">
    <!--suppress HtmlFormInputWithoutLabel, CheckTagEmptyBody -->
    <textarea rel="to-be-replaced">gym, </textarea>
</div>
<pre id="result">[ TBD ]</pre>
<script src="react.development.js"></script>
<script src="react-dom.development.js"></script>
<!--suppress ES6ConvertVarToLetConst -->
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        function delay(work) {
            setTimeout(work, 200 + Math.random() * 500)
        }
        var ajax = {
            "/tags": ["hot tub", "gym", "weights", "treadmill", "rowing machine", "stationary bicycle", "yoga", "stair climber", "basketball", "racket ball", "tennis", "swimming", "sauna", "home"],
            "/next?q=": [
                {t: "gym", nf: 0},
                {t: "hot tub", nf: 0},
                {t: "treadmill", nf: 0.8},
            ],
            "/next?q=gym": [
                {t: "weights", nf: 0},
                {t: "sauna", nf: 0},
                {t: "treadmill", nf: 0.8},
            ],
            "/next?q=gym,weights": [
                {t: "treadmill", nf: 0.8},
                {t: "yoga", nf: 0},
            ],
            "/next?q=hot tub": [
                {t: "gym", nf: 0},
                {t: "home", nf: 0},
            ],
        };
        var props = {
            debug: true,
            tagList: "",
            onChange: function(newTagList) {
                if (props.tagList === newTagList) return;
                props.tagList = newTagList;
                props.nextTags = null;
                delay(function() {
                    if (props.tagList !== newTagList) return;
                    var list = newTagList.split(",")
                        .map(function(it) { return it.trim() })
                        .map(function(it) { return it.indexOf(':') < 0
                            ? it
                            : it.split(":")[0].trim();
                        })
                        .filter(function(it) { return it.length > 0 })
                        .join(",");
                    props.nextTags = ajax["/next?q=" + list] || [];
                    update();
                });
                update();
            },
        };
        delay(function() {
            props.knownTags = ajax["/tags"];
            update();
        });
        props.onChange(document.querySelector("#tags textarea").value);
        function update() {
            document.getElementById("result").innerText = props.tagList;
            // noinspection ES6ModulesDependencies
            ReactDOM.render(
                React.createElement(TagEditor.default, props),
                document.getElementById("tags"),
            );
        }
        update();
    });
</script>
</body>
</html>
